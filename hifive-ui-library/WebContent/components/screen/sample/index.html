<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<meta name="viewport" content="width=device-width">

<link type="text/css" rel="stylesheet" href="../../../res/lib/hifive/h5.css">
<style>
.screen-wrapper {
	margin: 10px 0 0 40px;
}

.screen-nav {
	width: 400px;
	border: 1px solid #ccc;
	cursor: pointer;
}

.screen-nav .screentrack {
	font-size: 1.5em;
	text-align: center;
}

.screen-nav .prevpage {
	text-decoration: none;
	border-right: 1px solid #ccc;
	display: block;
	font-size: 1.5em;
	float: left;
}

.screen-nav .nextpage {
	text-decoration: none;
	border-left: 1px solid #ccc;
	display: block;
	font-size: 1.5em;
	float: right;
}

.screen {
	width: 400px;
	height: 400px;
	border: 1px solid #ccc;
}
</style>
<script type="text/javascript" src="../../../res/lib/jquery/jquery.js"></script>
<script type="text/javascript" src="../../../res/lib/hifive/ejs-h5mod.js"></script>
<script type="text/javascript" src="../../../res/lib/hifive/h5.js"></script>

<link type="text/css" rel="stylesheet" href="../src/screen.css">
<script type="text/javascript" src="../src/PageLoadLogic.js"></script>
<script type="text/javascript" src="../src/ScreenUIController.js"></script>

<script type="text/javascript" src="NavigationController.js"></script>
<script type="text/javascript" src="init.js"></script>

<title>スクリーン サンプル</title>
</head>
<body>
	<h1>スクリーン サンプル</h1>
	<div class="screen-wrapper">
		<div class="screen-nav">
			<a class="prevpage">前へ</a> <a class="nextpage">次へ</a>
			<div class="screentrack">トラックエリア</div>
		</div>
		<div class="screen">
			<div data-sample-url="page1.html">ページ1(未ロード)</div>
			<div data-sample-url="page2.html">ページ2(未ロード)</div>
			<div data-sample-url="page3.html">ページ3(未ロード)</div>
		</div>
	</div>

	<h2>ソースコード</h2>
	<h3>HTML</h3>
	<pre><code>&lt;div class=&quot;screen-wrapper&quot;&gt;
	&lt;div class=&quot;screen-nav&quot;&gt;
		&lt;a class=&quot;prevpage&quot;&gt;前へ&lt;/a&gt;
		&lt;a class=&quot;nextpage&quot;&gt;次へ&lt;/a&gt;
		&lt;a class=&quot;screentrack&quot;&gt;&lt;/a&gt;
	&lt;/div&gt;
	&lt;div class=&quot;screen&quot;&gt;
		&lt;div&gt;ページ1&lt;/div&gt;
		&lt;div&gt;ページ2&lt;/div&gt;
		&lt;div&gt;ページ3&lt;/div&gt;
	&lt;/div&gt;
&lt;/div&gt;
</code></pre>
	<h3>ナビゲーションコントローラの実装</h3>
	<pre><code>(function() {
	var navigationController = {
		/**
		 * @memberOf app.controller.NavigationController
		 */
		__name: 'app.controller.NavigationController',

		/**
		 * スクリーンのコンテンツURLリスト
		 *
		 * @memberOf app.controller.NavigationController
		 */
		_urlList: ['page1.html', 'page2.html', 'page3.html'],

		/**
		 * 現在スクリーンに表示中のコンテンツURLのインデックス
		 *
		 * @memberOf app.controller.NavigationController
		 */
		_urlIndex: 0,

		/**
		 * トラック操作開始からの移動量
		 *
		 * @memberOf app.controller.NavigationController
		 */
		_totalSlideAmount: 0,

		/**
		 * トラック操作中かどうか
		 *
		 * @memberOf app.controller.NavigationController
		 */
		_isTracking: false,

		/**
		 * @memberOf app.controller.NavigationController
		 */
		__ready: function() {
			this._$trackArea = this.$find('.screentrack');
			// URLリストの最初のページをロード
			this.trigger('loadPage', {
				url: this._urlList[this._urlIndex]
			});
		},

		/**
		 * @memberOf app.controller.NavigationController
		 * @param context
		 */
		'.prevpage click': function(context) {
			context.event.preventDefault();
			// 前(左)のページへスライドして、指定したURLをロード
			this._urlIndex = this._urlIndex === 0 ? this._urlList.length - 1 : --this._urlIndex;
			this.trigger('prevPage', {
				url: this._urlList[this._urlIndex]
			});
		},

		/**
		 * @memberOf app.controller.NavigationController
		 * @param context
		 */
		'.nextpage click': function(context) {
			context.event.preventDefault();
			// 前(左)のページへスライドして、指定したURLをロード
			this._urlIndex = this._urlIndex === this._urlList.length - 1 ? 0 : ++this._urlIndex;
			this.trigger('nextPage', {
				url: this._urlList[this._urlIndex]
			});
		},

		/**
		 * トラック
		 *
		 * @param context
		 * @memberOf app.controller.NavigationController
		 */
		'.screentrack h5trackstart': function(context) {
			// スクリーンがアニメーション動作中ならキャンセル
			if ($('.screen').hasClass('inOperation')) {
				return;
			}
			this._isTracking = true;
			this.trigger('screenTrackstart', {
				trackSize: this.$find('.screentrack').width()
			});
			this._totalSlideAmount = 0;
		},

		/**
		 * トラック
		 *
		 * @param context
		 * @memberOf app.controller.NavigationController
		 */
		'.screentrack h5trackmove': function(context) {
			if (!this._isTracking) {
				return;
			}
			var offsetX = context.event.offsetX;
			// トラック可能領域を制限
			if (offsetX < 0 || this.$find('.screentrack').width() < offsetX) {
				return;
			}
			var dx = context.event.dx;
			this._totalSlideAmount += dx;
			this.trigger('screenTrackmove', {
				dx: dx
			});
		},

		/**
		 * トラック
		 *
		 * @param context
		 * @memberOf app.controller.NavigationController
		 */
		'.screentrack h5trackend': function(context) {
			if (!this._isTracking) {
				return;
			}
			this._isTracking = false;
			// 移動先を判定
			if (this._totalSlideAmount > 100) {
				page = 'prev';
				this._urlIndex = this._urlIndex === 0 ? this._urlList.length - 1 : --this._urlIndex;
			} else if (this._totalSlideAmount < -100) {
				page = 'next';
				this._urlIndex = this._urlIndex === this._urlList.length - 1 ? 0 : ++this._urlIndex;
			} else {
				page = 'current';
			}

			this.trigger('screenTrackend', {
				page: page,
				url: this._urlList[this._urlIndex]
			});
		}
	};
	h5.core.expose(navigationController);
})();</code></pre>
	<h3>コントローラのバインド</h3>
	<pre><code>h5.core.controller('.screen-wrapper', h5.ui.components.screen.ScreenUIController, {
	navigationController: app.controller.NavigationController, // UI部品には含まれていません。個別の実装が必要です。
	navigationRootElement: '.screen-nav'
});</code></pre>
</body>
</html>